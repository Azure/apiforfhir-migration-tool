{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Fhir Migration Tool Deployment",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": []
                            }
                        },
                        {
                            "name": "prefix",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Prefix for Migration tool resources.",
                            "defaultValue": "",
                            "toolTip": "Provide a prefix value.",
                            "placeholder": "",
                            "multiLine": false,
                            "constraints": {
                              "required": true,
                              "validations": [
                                {
                                    "regex": "^[a-z0-9A-Z]{1,6}$",
                                    "message": "Only alphanumeric characters are allowed, and the value must be 1-6 characters long."
                                }
                            ]
                            },
                            "visible": true
                        },
                        {
                            "name": "fhirServiceName",
                            "label": "Select a FHIR Services inside an Azure Health Data Services workspace",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "resourceType": "Microsoft.HealthcareApis/workspaces/fhirservices",
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            },
                            "constraints": {
                                "required": false
                            },
                            "visible": true
                        },
                        {
                            "name": "apiForFhirName",
                            "label": "Select an API for FHIR resource",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "resourceType": "Microsoft.HealthcareApis/services",
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            },
                            "constraints": {
                                "required": false
                            },
                            "visible": true
                        },
                        {
                            "name": "storageAccountInfo",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                              "icon": "Info",
                              "text": "Please select a storage account that is linked with Azure API for FHIR \n Or any other existing storage account that you want to use.\n Or provide a name if you want to create & use a new storage account."
                            }
                        },
                        {
                            "name": "storageAccount",
                            "type": "Microsoft.Solutions.ResourceSelector",
                            "resourceType": "Microsoft.Storage/storageAccounts",
                            "options": {
                                "filter": {
                                    "subscription": "onBasics",
                                    "location": "onBasics"
                                }
                            },
                            "label": "Existing Storage Account",
                            "defaultValue": "",
                            "toolTip": "Name of the storage account.",
                            "constraints": {
                                "required": false
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "nameStorageAccount",
                            "type": "Microsoft.Common.TextBox",
                            "label": "New Storage Account Name",
                            "defaultValue": "",
                            "toolTip": "Provide name for new storage account.",
                            "placeholder": "",
                            "multiLine": false,
                            "constraints": {
                              "required": "[equals('', steps('basics').storageAccount)]",
                              "validations": [
                                {
                                  "regex": "^[a-z0-9]{3,24}$",
                                  "message": "Allowed: Length between 3 and 24 characters with only lowercase letters and numbers."
                                }
                              ]
                            },
                            "visible": true
                        },
                        {
                            "name": "containerWaring",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                              "icon": "Warning",
                              "text": "This application would use a container name \"Migration\",\n Please make sure this conatainer is excluded from any eventing setup on storage account.\nIf you have container name \"Migration\" in selected storage Account, please rename it."
                            }
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]",
            "parameters": {
                "prefix": "[steps('basics').prefix]",
                "location": "[steps('basics').resourceScope.location.name]",
                "fhirServiceName": "[steps('basics').fhirServiceName.name]",
                "apiForFhirName": "[steps('basics').apiForFhirName.name]",
                "storageAccount": "[steps('basics').storageAccount.name]",
                "storageAccountNew": "[steps('basics').nameStorageAccount]"
            }
        }
    }
}